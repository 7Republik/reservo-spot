{
  "name": "Verificador de Migraciones",
  "description": "Aviso discreto cuando se guardan migraciones significativas (cooldown: 1 hora)",
  "when": {
    "type": "fileEdit",
    "patterns": ["supabase/migrations/*.sql"]
  },
  "then": {
    "type": "askAgent",
    "prompt": "Se guard√≥ un archivo de migraci√≥n. Verifica si requiere actualizaci√≥n de documentaci√≥n.\n\n**PASO 1: LEER MIGRACI√ìN**\n\nLee el contenido del archivo guardado en supabase/migrations/\n\n**PASO 2: DETECTAR CAMBIOS SIGNIFICATIVOS**\n\nBusca:\n- CREATE TABLE (nueva tabla)\n- CREATE OR REPLACE FUNCTION (nueva funci√≥n)\n- ALTER TABLE ADD COLUMN (cambio en estructura)\n- CREATE POLICY (nueva pol√≠tica RLS)\n- CREATE TRIGGER (nuevo trigger)\n- CREATE BUCKET (nuevo storage bucket)\n\n**PASO 3: EVALUAR SIGNIFICANCIA**\n\nEs significativo SI:\n- ‚úÖ Nueva tabla en schema p√∫blico\n- ‚úÖ Nueva funci√≥n p√∫blica (no internal_*)\n- ‚úÖ Funci√≥n que se llama desde API (en RPC)\n- ‚úÖ Cambio en estructura de tabla p√∫blica\n- ‚úÖ Nuevo storage bucket\n\nNO es significativo SI:\n- ‚ùå Solo cambios en RLS policies\n- ‚ùå Solo cambios en √≠ndices\n- ‚ùå Solo cambios en triggers internos\n- ‚ùå Solo comentarios\n- ‚ùå Funciones internas (internal_*, private_*)\n\n**PASO 4: MOSTRAR AVISO (SOLO SI ES SIGNIFICATIVO)**\n\nSi es significativo, muestra mensaje ultra-conciso (m√°ximo 2 l√≠neas):\n\n```\nüí° Nueva migraci√≥n con cambios significativos detectada.\n   Considera ejecutar \"Sync Docs\" y \"Update K6 Tests\" cuando termines.\n```\n\n**REGLAS CR√çTICAS:**\n- ‚ùå NO interrumpir el trabajo del usuario\n- ‚ùå NO mostrar si no es significativo\n- ‚ùå NO actualizar ning√∫n archivo\n- ‚ùå NO crear documentaci√≥n\n- ‚úÖ Solo mostrar mensaje discreto\n- ‚úÖ Mensaje m√°ximo 2 l√≠neas\n- ‚úÖ Tono amigable, no imperativo"
  }
}
