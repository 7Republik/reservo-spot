{
  "name": "Actualizar Tests K6",
  "description": "Mantiene los tests de carga K6 actualizados con los cambios en la API y funciones de Supabase",
  "when": {
    "type": "userTriggered"
  },
  "then": {
    "type": "askAgent",
    "prompt": "Analiza las migraciones recientes de Supabase y sugiere actualizaciones para los tests K6.\n\n**PASO 1: ANÃLISIS DE MIGRACIONES**\n\n1. Lista las Ãºltimas 5 migraciones en supabase/migrations/\n2. Lee el contenido de cada migraciÃ³n\n3. Identifica cambios significativos:\n   - Nuevas tablas pÃºblicas\n   - Nuevas funciones SQL pÃºblicas (que pueden llamarse desde la API)\n   - Cambios en funciones existentes\n   - Nuevos endpoints o cambios en RLS\n\n**PASO 2: INVENTARIO DE TESTS ACTUALES**\n\n1. Lista archivos en tests/k6/\n2. Identifica quÃ© funcionalidades estÃ¡n cubiertas:\n   - checkin-test.js â†’ Check-in/check-out\n   - waitlist-test.js â†’ Lista de espera\n   - checkin-stats-test.js â†’ EstadÃ­sticas\n   - [otros tests]\n\n**PASO 3: DETECCIÃ“N DE GAPS**\n\nCompara migraciones vs tests:\n```\nğŸ“Š AnÃ¡lisis de cobertura:\n\nFunciones nuevas detectadas:\n- function_name_1() â†’ âŒ Sin test\n- function_name_2() â†’ âœ… Cubierta en waitlist-test.js\n- function_name_3() â†’ âŒ Sin test\n\nTablas nuevas detectadas:\n- table_name_1 â†’ âŒ Sin test de CRUD\n- table_name_2 â†’ âœ… Cubierta en checkin-test.js\n\nEndpoints afectados:\n- POST /rest/v1/rpc/function_name_1 â†’ âŒ Sin test\n```\n\n**PASO 4: SUGERENCIAS**\n\nPara cada gap detectado, sugiere:\n1. Nombre del archivo de test (ej: `new-feature-test.js`)\n2. Escenarios de prueba necesarios\n3. ConfiguraciÃ³n en `.env.k6` si aplica\n4. Ejemplo de cÃ³digo bÃ¡sico\n\n**PASO 5: CONFIRMACIÃ“N**\n\nPregunta: \"Â¿QuÃ© tests quieres crear/actualizar? (todos/seleccionar/cancelar)\"\n\n**PASO 6: CREAR TESTS**\n\nSolo crea los tests confirmados:\n- Usa la estructura estÃ¡ndar de tests K6 del proyecto\n- Incluye comentarios explicativos\n- AÃ±ade variables a `.env.k6` si es necesario\n- Actualiza `tests/k6/README.md` con el nuevo test\n- AÃ±ade comando npm en package.json si aplica\n\n**REGLAS IMPORTANTES:**\n- NO crear tests para funciones internas (solo pÃºblicas)\n- NO crear tests para tablas sin endpoints pÃºblicos\n- Enfocarse en tests de carga, no unitarios\n- Seguir patrones existentes en tests/k6/\n- Mantener tests simples y enfocados"
  }
}
